<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Image Steganography</title>
  <link rel="icon" href="/static/favicon.svg" type="image/svg+xml" />
  <link rel="shortcut icon" href="/static/favicon.svg" />
  <style>
    *, *::before, *::after { box-sizing: border-box; }
    html, body { height: 100%; margin: 0; }
    body {
      background:
        radial-gradient(800px 500px at 70% 20%, rgba(0,122,255,.35), transparent 60%),
        radial-gradient(600px 400px at 20% 80%, rgba(0,122,255,.18), transparent 60%),
        linear-gradient(180deg, #000814, #001427, #001d3d);
      color: #cfe8ff;
      font-family: system-ui, Segoe UI, Roboto, Arial;
      display: block;
      min-height: 100vh;
      padding: 96px 16px 28px; /* keep content clear of fixed nav */
    }
    main { max-width: 960px; margin: 0 auto; }
    /* removed wall label */
    /* Glass buttons bar */
    .glass-nav { position: fixed; top: 18px; left: 50%; transform: translateX(-50%); display: flex; gap: 10px; padding: 8px; border-radius: 999px; backdrop-filter: blur(10px) saturate(130%); background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.14); box-shadow: 0 8px 26px rgba(0,0,0,.35); z-index: 10; max-width: min(620px, 94vw); overflow-x: auto; -webkit-overflow-scrolling: touch; white-space: nowrap; }
    .gbtn { appearance: none; border: 1px solid rgba(255,255,255,0.14); color: #e6f1ff; background: rgba(0,0,0,0.25); padding: 10px 16px; border-radius: 999px; cursor: pointer; font-weight: 600; letter-spacing: .02em; transition: border-color .2s ease, background .2s ease, transform .06s ease, box-shadow .2s ease; }
    .gbtn:hover { transform: translateY(-1px); border-color: rgba(0,174,255,.55); box-shadow: 0 6px 18px rgba(0,174,255,.25); }
    .gbtn.primary { background: linear-gradient(135deg, rgba(0,174,255,.35), rgba(170,0,255,.28)); color: #0b0f1a; }
    /* Panels */
    .panel { width: 100%; margin-top: 12px; padding: 22px; border-radius: 18px; border: 1px solid rgba(148,182,210,.18); background: rgba(0,8,20,.45); backdrop-filter: blur(14px) saturate(140%); box-shadow: 0 18px 50px rgba(0,0,0,.45), inset 0 0 0 1px rgba(255,255,255,.02); overflow: visible; }
    .panel h2 { margin: 0 0 10px; color: #eaf4ff; font-size: 20px; }
    .muted { color: #9db8d6; margin: 0 0 16px; }
    .grid { display: grid; gap: 14px; }
    label { color: #75d1ff; font-size: 14px; margin-bottom: 6px; }
    input[type="file"], select, textarea { width: 100%; padding: 12px 14px; border-radius: 14px; border: 1px solid rgba(148,182,210,.22); background: rgba(2,12,22,.7); color: #eaf4ff; outline: none; }
    textarea { resize: vertical; min-height: 120px; line-height: 1.4; box-shadow: inset 0 0 0 1px rgba(255,255,255,.02); border-radius: 14px; background-clip: padding-box; overflow: hidden; margin-bottom: 8px; }
    textarea::-webkit-resizer { background: transparent; }
    select:focus, textarea:focus { border-color: rgba(0,174,255,.6); box-shadow: 0 0 0 3px rgba(0,174,255,.15); }
    .row { display: grid; gap: 10px; }
    .row.inline { grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); align-items: end; }
    .btn { appearance: none; border: 1px solid rgba(148,182,210,.22); background: linear-gradient(135deg, #6e00ff, #00bfff); color: #071019; padding: 11px 18px; border-radius: 12px; font-weight: 700; cursor: pointer; box-shadow: 0 8px 24px rgba(0,174,255,.25); margin-top: 8px; }
    .btn:hover { filter: brightness(1.05); transform: translateY(-1px); }
    .hidden { display: none; }
    /* Dropzone */
    .dropzone { display: grid; place-items: center; gap: 4px; border: 1.5px dashed rgba(148,182,210,.28); border-radius: 14px; padding: 24px; background: rgba(0,0,0,.35); cursor: pointer; transition: border-color .2s ease, background .2s ease, box-shadow .2s ease, transform .08s ease; }
    .dropzone:hover { border-color: rgba(0,174,255,.6); box-shadow: 0 10px 28px rgba(0,174,255,.18); }
    .dropzone.drag { border-color: rgba(0,174,255,.9); background: rgba(0,33,66,.45); box-shadow: 0 10px 32px rgba(0,174,255,.28); transform: translateY(-1px); }
    .dz-icon { display: grid; place-items: center; }
    .dz-icon img { width: 52px; height: 52px; object-fit: contain; opacity: .9; filter: drop-shadow(0 2px 6px rgba(0,174,255,.25)); }
    .dz-text { color: #eaf4ff; font-weight: 600; }
    .dz-sub { color: #9db8d6; font-size: 12px; }
    .dz-file { color: #9fe1ff; font-size: 13px; }
    .native-file { position: absolute; left: -9999px; width: 1px; height: 1px; opacity: 0; }

    /* Loading overlay */
    .loading-overlay { position: fixed; inset: 0; background: rgba(0, 4, 12, 0.55); backdrop-filter: blur(5px); display: none; place-items: center; z-index: 20; }
    .loading-overlay.active { display: grid; }
    .spinner { width: 64px; height: 64px; border-radius: 50%; border: 3px solid rgba(0,174,255,.25); border-top-color: #00bfff; animation: spin 0.9s linear infinite; box-shadow: 0 0 20px rgba(0,174,255,.25); }
    .loading-text { margin-top: 12px; color: #bfe8ff; font-weight: 600; text-shadow: 0 0 10px rgba(0,174,255,.25); }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* Mobile adjustments */
    @media (max-width: 768px) {
      body { padding: 84px 12px 24px; overflow-x: hidden; }
      .glass-nav { top: 10px; gap: 6px; padding: 6px; }
      .gbtn { padding: 8px 12px; font-size: 13px; }
      .panel { padding: 16px; border-radius: 16px; }
      .dz-icon img { width: 44px; height: 44px; }
      .dropzone { padding: 18px; }
      .dz-text { font-size: 14px; text-align: center; }
      label { font-size: 13px; }
      textarea { min-height: 100px; }
    }
    @media (max-width: 420px) {
      body { padding: max(72px, calc(72px + env(safe-area-inset-top))) 10px 20px; }
      .glass-nav { transform: translateX(-50%) scale(.94); }
      .gbtn { padding: 7px 10px; font-size: 12px; }
      .btn { width: 100%; }
    }
  </style>
</head>
<body>
  <!-- Loading overlay -->
  <div id="loading" class="loading-overlay" aria-live="polite" aria-hidden="true">
    <div style="display:grid; place-items:center; gap:10px;">
      <div class="spinner" role="progressbar" aria-label="Loading"></div>
      <div class="loading-text">Processing…</div>
    </div>
  </div>
  <!-- Top glass buttons -->
  <nav class="glass-nav" aria-label="Primary actions">
    <button class="gbtn primary" type="button">Encode (Insert) Data</button>
    <button class="gbtn" type="button">Decode (Extract) Data</button>
  </nav>
  <main>
    
    <!-- Encode Panel -->
    <section id="encodePanel" class="panel">
      <h2>Encode (Insert) Data</h2>
      <p class="muted">Hide text or a file inside a cover image (PNG recommended).</p>
      <form id="encodeForm" class="grid">
        <div class="row">
          <label>Cover Image</label>
          <div class="dropzone" data-for="encodeImage">
            <div class="dz-icon" aria-hidden="true"><img alt="drop icon" src="https://cdn-icons-png.flaticon.com/512/9261/9261193.png" /></div>
            <div class="dz-text">Drop an image here or click to browse</div>
            <div class="dz-sub">Supports PNG, JPG, JPEG</div>
            <div class="dz-file" id="encodeFileLabel"></div>
          </div>
          <input id="encodeImage" class="native-file" type="file" name="image" accept="image/*" required />
        </div>
        <div class="row inline">
          <div>
            <label>Mode</label>
            <select name="mode" id="mode">
              <option value="text">Text</option>
              <option value="file">File</option>
            </select>
          </div>
        </div>
        <div class="row" id="textRow">
          <label>Text to hide</label>
          <textarea name="text" rows="4" placeholder="Enter secret message..."></textarea>
        </div>
        <div class="row hidden" id="fileRow">
          <label>File to hide</label>
          <input type="file" name="payload" />
        </div>
        <div>
          <button type="submit" class="btn">Encode & Download</button>
        </div>
      </form>
    </section>

    <!-- Decode Panel -->
    <section id="decodePanel" class="panel hidden">
      <h2>Decode (Extract) Data</h2>
      <p class="muted">Extract hidden content from a stego image.</p>
      <form id="decodeForm" class="grid">
        <div class="row">
          <label>Stego Image</label>
          <div class="dropzone" data-for="decodeImage">
            <div class="dz-icon" aria-hidden="true"><img alt="drop icon" src="https://cdn-icons-png.flaticon.com/512/9261/9261193.png" /></div>
            <div class="dz-text">Drop a stego image here or click to browse</div>
            <div class="dz-sub">PNG recommended for accuracy</div>
            <div class="dz-file" id="decodeFileLabel"></div>
          </div>
          <input id="decodeImage" class="native-file" type="file" name="image" accept="image/*" required />
        </div>
        <div>
          <button type="submit" class="btn">Decode & Download</button>
        </div>
      </form>
    </section>
  </main>
  <script>
    // Toggle panels on button click
    const btns = document.querySelectorAll('.gbtn');
    const encBtn = btns[0];
    const decBtn = btns[1];
    const encPanel = document.getElementById('encodePanel');
    const decPanel = document.getElementById('decodePanel');
    function show(panel) {
      if (panel === 'enc') { encPanel.classList.remove('hidden'); decPanel.classList.add('hidden'); encBtn.classList.add('primary'); decBtn.classList.remove('primary'); }
      else { decPanel.classList.remove('hidden'); encPanel.classList.add('hidden'); decBtn.classList.add('primary'); encBtn.classList.remove('primary'); }
    }
    encBtn.addEventListener('click', () => show('enc'));
    decBtn.addEventListener('click', () => show('dec'));

    // Mode toggle (text/file)
    const modeSel = document.getElementById('mode');
    const textRow = document.getElementById('textRow');
    const fileRow = document.getElementById('fileRow');
    modeSel.addEventListener('change', () => {
      if (modeSel.value === 'text') { textRow.classList.remove('hidden'); fileRow.classList.add('hidden'); }
      else { textRow.classList.add('hidden'); fileRow.classList.remove('hidden'); }
    });

    // Drag & drop wiring
    function wireDropzone(zone, input, label) {
      const updateLabel = () => {
        const f = input.files && input.files[0];
        label.textContent = f ? f.name + ` (${Math.round(f.size/1024)} KB)` : '';
      };
      // Open file dialog on click
      zone.addEventListener('click', () => input.click());
      // Reflect manual selection
      input.addEventListener('change', updateLabel);
      // Drag behaviors
      ['dragenter','dragover'].forEach(evt => zone.addEventListener(evt, e => { e.preventDefault(); e.stopPropagation(); zone.classList.add('drag'); }));
      ['dragleave','drop'].forEach(evt => zone.addEventListener(evt, e => { e.preventDefault(); e.stopPropagation(); zone.classList.remove('drag'); }));
      zone.addEventListener('drop', e => {
        const files = e.dataTransfer?.files;
        if (!files || !files.length) return;
        const dt = new DataTransfer();
        dt.items.add(files[0]);
        input.files = dt.files;
        input.dispatchEvent(new Event('change'));
      });
    }
    // Apply to both zones
    const encZone = document.querySelector('.dropzone[data-for="encodeImage"]');
    const decZone = document.querySelector('.dropzone[data-for="decodeImage"]');
    const encInput = document.getElementById('encodeImage');
    const decInput = document.getElementById('decodeImage');
    const encLabel = document.getElementById('encodeFileLabel');
    const decLabel = document.getElementById('decodeFileLabel');
    if (encZone && encInput && encLabel) wireDropzone(encZone, encInput, encLabel);
    if (decZone && decInput && decLabel) wireDropzone(decZone, decInput, decLabel);

    async function postForm(url, formEl) {
      const fd = new FormData(formEl);
      const res = await fetch(url, { method: 'POST', body: fd });
      return res;
    }
    const loadingEl = document.getElementById('loading');
    const showLoading = (msg) => { if (loadingEl) { loadingEl.classList.add('active'); loadingEl.setAttribute('aria-hidden','false'); if (msg) loadingEl.querySelector('.loading-text').textContent = msg; document.body.style.cursor='progress'; } };
    const hideLoading = () => { if (loadingEl) { loadingEl.classList.remove('active'); loadingEl.setAttribute('aria-hidden','true'); document.body.style.cursor=''; } };
    // Encode submit
    document.getElementById('encodeForm')?.addEventListener('submit', async (e) => {
      e.preventDefault();
      try {
        showLoading('Encoding…');
        const res = await postForm('/encode', e.target);
        const ct = res.headers.get('content-type') || '';
        if (ct.includes('application/json')) {
          const data = await res.json();
          if (!res.ok) throw new Error(data.error || 'Encode failed');
        }
        const blob = await res.blob();
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a'); a.href = url; a.download = 'stego.png'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
      } catch (err) { alert('Error: ' + err.message); }
      finally { hideLoading(); }
    });
    // Decode submit
    document.getElementById('decodeForm')?.addEventListener('submit', async (e) => {
      e.preventDefault();
      try {
        showLoading('Decoding…');
        const res = await postForm('/decode', e.target);
        const ct = res.headers.get('content-type') || '';
        if (ct.includes('application/json')) {
          const data = await res.json();
          if (!res.ok) throw new Error(data.error || 'Decode failed');
        }
        const disp = res.headers.get('Content-Disposition') || '';
        let filename = 'payload.bin'; const m = /filename="?([^";]+)"?/i.exec(disp); if (m) filename = m[1];
        const blob = await res.blob();
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a'); a.href = url; a.download = filename; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
      } catch (err) { alert('Error: ' + err.message); }
      finally { hideLoading(); }
    });
  </script>
</body>
</html>
